<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Image Alchemy - Advanced Search App</title>
<style>
@import url("https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap");
*{box-sizing:border-box;font-family:'Poppins',sans-serif;}
body{margin:0;background:#f6f6f9;color:#333;}
header{text-align:center;padding:30px 10px;background:linear-gradient(135deg,#4e54c8,#8f94fb);color:#fff;position:relative;}
header h1{font-size:2rem;margin-bottom:10px;}
header p{font-size:0.9rem;opacity:0.8;}
.top-btn{position:absolute;top:15px;right:20px;background:#fff;color:#4e54c8;border:none;padding:10px 20px;border-radius:25px;cursor:pointer;font-weight:600;transition:.3s;}
.top-btn:hover{background:#4e54c8;color:#fff;}
#logoutBtn{display:none;}
.user-info{margin-top:10px;font-size:0.9rem;}
.login-popup{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);justify-content:center;align-items:center;z-index:1000;}
.login-box{background:#fff;padding:30px;border-radius:15px;text-align:center;width:90%;max-width:350px;box-shadow:0 4px 20px rgba(0,0,0,.2);}
.login-box h2{margin-bottom:20px;color:#4e54c8;}
.login-box input{width:90%;padding:10px;margin:10px 0;border-radius:25px;border:1px solid #ccc;outline:none;text-align:center;}
.login-box button{margin-top:10px;background:#4e54c8;color:#fff;border:none;padding:10px 25px;border-radius:25px;cursor:pointer;font-weight:600;}
.login-box button:hover{background:#6c72f5;}
.slideshow{position:relative;width:100%;max-width:1000px;height:400px;margin:20px auto;overflow:hidden;border-radius:15px;box-shadow:0 4px 20px rgba(0,0,0,.15);}
.slideshow img{position:absolute;width:100%;height:100%;object-fit:cover;opacity:0;transition:opacity 1s ease-in-out;}
.slideshow img.active{opacity:1;}
.slide-btn{position:absolute;top:50%;transform:translateY(-50%);background:rgba(0,0,0,.4);color:#fff;border:none;padding:10px 15px;border-radius:50%;cursor:pointer;font-size:18px;}
.prev-btn{left:10px;}
.next-btn{right:10px;}
.search-bar{display:flex;justify-content:center;margin-top:15px;}
.search-bar input{width:60%;max-width:500px;padding:12px 20px;border-radius:30px;border:none;outline:none;font-size:1rem;box-shadow:0 4px 8px rgba(0,0,0,.1);}
.search-bar button{margin-left:10px;padding:12px 20px;border:none;background:#fff;border-radius:25px;cursor:pointer;font-weight:600;color:#4e54c8;transition:.3s;}
.search-bar button:hover{background:#4e54c8;color:#fff;}
#gallery{column-count:4;column-gap:15px;padding:20px;max-width:1300px;margin:auto;}
@media(max-width:1000px){#gallery{column-count:3;}}
@media(max-width:700px){#gallery{column-count:2;}}
@media(max-width:480px){#gallery{column-count:1;}}
.photo{position:relative;margin-bottom:15px;border-radius:10px;overflow:hidden;cursor:zoom-in;}
.photo img{width:100%;display:block;border-radius:10px;transition:transform .3s ease;}
.photo:hover img{transform:scale(1.05);}
.photo-info{position:absolute;bottom:0;left:0;right:0;padding:10px;background:linear-gradient(transparent,rgba(0,0,0,.7));color:#fff;display:flex;justify-content:space-between;align-items:center;font-size:.8rem;gap:10px;flex-wrap:wrap;}
.photo-info button{background:rgba(255,255,255,.2);border:none;padding:5px 10px;border-radius:5px;color:#fff;cursor:pointer;}
.photo-info button:hover{background:rgba(255,255,255,.4);}
.load-more{display:none;margin:20px auto;padding:12px 25px;border-radius:25px;background:#4e54c8;color:#fff;border:none;cursor:pointer;font-weight:500;}
.loading{text-align:center;font-size:1rem;margin-top:15px;color:#4e54c8;}
footer{text-align:center;padding:20px;font-size:.8rem;color:#555;}
/* ============= NEW GEO CSS ============= */
.ip-geo-info {
  text-align:center;
  font-size:0.92rem;
  background:#e1e7fa;
  color:#31438e;
  padding:4px 0 4px 0;
  margin-bottom:8px;
  margin-top:0;
  letter-spacing:0.01em;
  box-shadow: 0 1px 4px rgba(100,100,200,0.07);
  font-weight:500;
  border-bottom:1px solid #c4d8fc;
}
</style>
</head>
<body>
<header>
Â  <button class="top-btn" id="loginBtn">Login</button>
Â  <button class="top-btn" id="logoutBtn">Logout</button>
Â  <h1>Image Alchemy</h1>
Â  <p>Search and explore millions of photos from Unsplash</p>
Â  <div class="search-bar">
Â  Â  <input type="text" id="searchInput" placeholder="Search for photos..." />
Â  Â  <button id="searchBtn">Search</button>
Â  </div>
Â  <div class="user-info" id="userInfo"></div>
</header>

<!-- IP Geolocation Info Box (ADDED) -->
<div id="ipGeoInfo" class="ip-geo-info"></div>

<div class="login-popup" id="loginPopup">
Â  <div class="login-box">
Â  Â  <h2>User Login</h2>
Â  Â  <input type="text" id="username" placeholder="Enter Username" />
Â  Â  <input type="password" id="password" placeholder="Enter Password" />
Â  Â  <button id="submitLogin">Login</button>
Â  </div>
</div>

<section class="slideshow" id="slideshow">
Â  <button class="slide-btn prev-btn" id="prevBtn">â®</button>
Â  <button class="slide-btn next-btn" id="nextBtn">â¯</button>
</section>

<section id="gallery"></section>
<div class="loading" id="loadingMsg"></div>
<button class="load-more" id="loadMoreBtn">Show More</button>
<footer>Built by Image Alchemy | Powered by Unsplash API</footer>

<script>
const accessKey="kpTk6w_8M5_rfyvKdNgEyzkZTQEEkzvdOMFsk9Ti2c0";

const loginBtn=document.getElementById("loginBtn");
const logoutBtn=document.getElementById("logoutBtn");
const loginPopup=document.getElementById("loginPopup");
const submitLogin=document.getElementById("submitLogin");
const userInfo=document.getElementById("userInfo");
const usernameInput=document.getElementById("username");
const passwordInput=document.getElementById("password");

let loggedIn=false;
let searchCount=0;

// === LOGIN / LOGOUT ===
loginBtn.addEventListener("click",()=>{loginPopup.style.display="flex";});
submitLogin.addEventListener("click",()=>{
Â  const username=usernameInput.value.trim();
Â  const password=passwordInput.value.trim();
Â  if(!username||!password){alert("Please enter username and password!");return;}
Â  loggedIn=true;
Â  loginPopup.style.display="none";
Â  loginBtn.style.display="none";
Â  logoutBtn.style.display="block";
Â  getLocation(username);
});
logoutBtn.addEventListener("click",()=>{
Â  loggedIn=false;
Â  searchCount=0;
Â  userInfo.textContent="";
Â  logoutBtn.style.display="none";
Â  loginBtn.style.display="block";
Â  searchInput.value="";
Â  gallery.innerHTML="";
Â  slideshow.style.display="block"; // show slideshow again on logout
Â  alert("You have successfully logged out!");
});

async function getLocation(username){
Â  if(!navigator.geolocation){
Â  Â  userInfo.textContent=`Welcome ${username}! (Location not supported)`;
Â  Â  return;
Â  }
Â  navigator.geolocation.getCurrentPosition(async pos=>{
Â  Â  const {latitude,longitude}=pos.coords;
Â  Â  try{
Â  Â  Â  const res=await fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${latitude}&lon=${longitude}`);
Â  Â  Â  const data=await res.json();
Â  Â  Â  const city=data.address.city||data.address.town||data.address.village||"Unknown area";
Â  Â  Â  const country=data.address.country||"";
Â  Â  Â  userInfo.textContent=`ğŸ‘‹ Welcome ${username}`;
Â  Â  }catch{
Â  Â  Â  userInfo.textContent=`ğŸ‘‹ Welcome ${username}! (Couldnâ€™t fetch location)`;
Â  Â  }
Â  },()=>{userInfo.textContent=`ğŸ‘‹ Welcome ${username}! (Location denied)`;});
}

// === SLIDESHOW ===
const slideshow=document.getElementById("slideshow");
const prevBtn=document.getElementById("prevBtn");
const nextBtn=document.getElementById("nextBtn");
let slideImages=[],slideIndex=0;

async function loadSlideshowImages(){
Â  const url=`https://api.unsplash.com/photos/random?count=5&client_id=${accessKey}`;
Â  try{
Â  Â  const res=await fetch(url);
Â  Â  const data=await res.json();
Â  Â  slideImages=data.map(img=>img.urls.regular);
Â  Â  renderSlideshow();
Â  }catch(e){console.error("Failed to load slideshow",e);}
}
function renderSlideshow(){
Â  slideshow.querySelectorAll("img").forEach(img=>img.remove());
Â  slideImages.forEach((src,i)=>{
Â  Â  const img=document.createElement("img");
Â  Â  img.src=src;
Â  Â  if(i===0)img.classList.add("active");
Â  Â  slideshow.appendChild(img);
Â  });
Â  startSlideshow();
}
function startSlideshow(){
Â  const imgs=slideshow.querySelectorAll("img");
Â  if(imgs.length===0)return;
Â  setInterval(()=>{
Â  Â  imgs[slideIndex].classList.remove("active");
Â  Â  slideIndex=(slideIndex+1)%imgs.length;
Â  Â  imgs[slideIndex].classList.add("active");
Â  },4000);
}
prevBtn.addEventListener("click",()=>changeSlide(-1));
nextBtn.addEventListener("click",()=>changeSlide(1));
function changeSlide(dir){
Â  const imgs=slideshow.querySelectorAll("img");
Â  if(imgs.length===0)return;
Â  imgs[slideIndex].classList.remove("active");
Â  slideIndex=(slideIndex+dir+imgs.length)%imgs.length;
Â  imgs[slideIndex].classList.add("active");
}

// === IMAGE SEARCH ===
const gallery=document.getElementById("gallery");
const searchInput=document.getElementById("searchInput");
const searchBtn=document.getElementById("searchBtn");
const loadMoreBtn=document.getElementById("loadMoreBtn");
const loadingMsg=document.getElementById("loadingMsg");
let currentQuery="",currentPage=1;

async function searchImages(query,page=1){
Â  const endpoint=`https://api.unsplash.com/search/photos?page=${page}&query=${encodeURIComponent(query)}&per_page=20&client_id=${accessKey}`;
Â  try{
Â  Â  loadingMsg.textContent="Loading...";
Â  Â  const res=await fetch(endpoint);
Â  Â  const data=await res.json();
Â  Â  loadingMsg.textContent="";
Â  Â  return data.results;
Â  }catch{
Â  Â  loadingMsg.textContent="Error loading images ğŸ˜¢";
Â  Â  return[];
Â  }
}
function renderImages(images,append=false){
Â  if(!append)gallery.innerHTML="";
Â  if(images.length===0){
Â  Â  gallery.innerHTML="<p style='text-align:center;color:#777;'>No results found.</p>";
Â  Â  loadMoreBtn.style.display="none";
Â  Â  return;
Â  }
Â  images.forEach(img=>{
Â  Â  const div=document.createElement("div");
Â  Â  div.className="photo";
Â  Â  div.innerHTML=`
Â  Â  Â  <img src="${img.urls.small}" alt="${img.alt_description||"photo"}" loading="lazy">
Â  Â  Â  <div class="photo-info">
Â  Â  Â  Â  <span>${img.user.name}</span>
Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  <button onclick="window.open('${img.links.html}','_blank')">View</button>
Â  Â  Â  Â  Â  <button onclick="downloadImage('${img.urls.full}')">Download</button>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>`;
Â  Â  gallery.appendChild(div);
Â  });
Â  loadMoreBtn.style.display="block";
}

async function downloadImage(url){
Â  try{
Â  Â  const res=await fetch(url);
Â  Â  const blob=await res.blob();
Â  Â  const a=document.createElement("a");
Â  Â  a.href=URL.createObjectURL(blob);
Â  Â  a.download="image.jpg";
Â  Â  a.click();
Â  }catch{alert("Failed to download image.");}
}

searchBtn.addEventListener("click",handleSearch);
searchInput.addEventListener("keypress",e=>{if(e.key==="Enter")handleSearch();});

// === Show slideshow again if input is cleared ===
searchInput.addEventListener("input",()=>{
Â  if(searchInput.value.trim()===""){
Â  Â  gallery.innerHTML="";
Â  Â  loadMoreBtn.style.display="none";
Â  Â  slideshow.style.display="block";
Â  }
});

loadMoreBtn.addEventListener("click",loadMore);

async function handleSearch(){
Â  const query=searchInput.value.trim();
Â  if(!query){
Â  Â  slideshow.style.display="block";
Â  Â  gallery.innerHTML="";
Â  Â  return;
Â  }
Â  // hide slideshow when searching
Â  slideshow.style.display="none";
Â  
Â  if(!loggedIn){
Â  Â  if(searchCount>=3){
Â  Â  Â  alert("You have reached the free search limit! Please log in to continue.");
Â  Â  Â  loginPopup.style.display="flex";
Â  Â  Â  return;
Â  Â  }
Â  Â  searchCount++;
Â  }
Â  currentQuery=query;currentPage=1;
Â  const results=await searchImages(query);
Â  renderImages(results);
}

async function loadMore(){
Â  currentPage++;
Â  const results=await searchImages(currentQuery,currentPage);
Â  renderImages(results,true);
}

loadSlideshowImages();

// === IP-BASED GEOLOCATION (ADDED FEATURE) ===
async function fetchIPGeolocation() {
Â  try {
Â  Â  const resp = await fetch('https://ipapi.co/json/');
Â  Â  const geo = await resp.json();
Â  Â  let ipGeoDiv = document.getElementById("ipGeoInfo");
Â  Â  if (!ipGeoDiv) {
Â  Â  Â  ipGeoDiv = document.createElement('div');
Â  Â  Â  ipGeoDiv.id = "ipGeoInfo";
Â  Â  Â  ipGeoDiv.className = "ip-geo-info";
Â  Â  Â  document.body.insertBefore(ipGeoDiv, document.body.firstChild.nextSibling);
Â  Â  }
Â  Â  ipGeoDiv.textContent = `ğŸŒ IP Geolocation: ${geo.city || "N/A"}, ${geo.region || "N/A"}, ${geo.country_name || "N/A"}`;
Â  } catch {
Â  Â  // Fail silently or add fallback text if desired
Â  }
}
fetchIPGeolocation();

</script>
</body>
</html>
